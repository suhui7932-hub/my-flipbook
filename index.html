import os
import fitz
import shutil
import time

def show_intro():
    print("=" * 50)
    print("           ğŸ“– í”Œë¦½ë¶ ë³€í™˜ê¸° (ëª¨ë°”ì¼/PC í†µí•©í˜•)")
    print("=" * 50)
    print("  1. PDF íŒŒì¼ì„ ì´ ì°½ìœ¼ë¡œ ë“œë˜ê·¸í•˜ì„¸ìš”.")
    print("  2. ì—”í„°ë¥¼ ëˆ„ë¥´ë©´ ë³€í™˜ì´ ì‹œì‘ë©ë‹ˆë‹¤.")
    print("-" * 50)

def convert_to_web(pdf_path):
    base_dir = os.path.dirname(os.path.abspath(__file__))
    app_name = os.path.splitext(os.path.basename(pdf_path))[0]
    output_dir = os.path.join(base_dir, f"{app_name}_ì™„ì„±ë³¸")
    pages_dir = os.path.join(output_dir, "pages")

    if os.path.exists(output_dir):
        shutil.rmtree(output_dir)
    os.makedirs(pages_dir)

    print(f"â–¶ [{app_name}] ê³ í™”ì§ˆ ì´ë¯¸ì§€ ì¶”ì¶œ ì¤‘...")
    doc = fitz.open(pdf_path)
    total = len(doc)
    
    for i in range(total):
        page = doc.load_page(i)
        # ì„ ëª…í•œ í™”ì§ˆì„ ìœ„í•´ í•´ìƒë„ ì¡°ì ˆ
        pix = page.get_pixmap(matrix=fitz.Matrix(2, 2))
        pix.save(os.path.join(pages_dir, f"{i+1}.jpg"))
        print(f"   - ì§„í–‰ë¥ : {i+1}/{total} ì™„ë£Œ", end='\r')
    
    doc.close()

    # ëª¨ë°”ì¼/íƒœë¸”ë¦¿/PC ëª¨ë‘ ëŒ€ì‘í•˜ëŠ” 3D ì–‘ë©´ í”Œë¦½ ì›¹ ì½”ë“œ
    html_content = f"""
<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{app_name}</title>
    <script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="https://rawcdn.githack.com/blasten/turn.js/master/lib/turn.min.js"></script>
    <style>
        body {{ background: #2c2c2c; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }}
        #viewport {{ width: 95vw; height: 90vh; display: flex; justify-content: center; align-items: center; }}
        #flipbook {{ width: 1000px; height: 700px; }}
        .page {{ background: white; }}
        .page img {{ width: 100%; height: 100%; object-fit: contain; }}
        /* ì œë³¸ì„  ê·¸ë¦¼ì */
        .shadow {{ box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }}
    </style>
</head>
<body>
    <div id="viewport">
        <div id="flipbook">
            {"".join([f'<div class="page shadow"><img src="pages/{i+1}.jpg"></div>' for i in range(total)])}
        </div>
    </div>
    <script>
        function loadApp() {{
            var flipbook = $('#flipbook');
            var winW = $(window).width();
            
            // ëª¨ë°”ì¼ì¸ì§€ PCì¸ì§€ íŒë³„í•˜ì—¬ ë ˆì´ì•„ì›ƒ ì¡°ì •
            var displayMode = (winW < 600) ? 'single' : 'double';
            
            flipbook.turn({{
                width: $('#viewport').width(),
                height: $('#viewport').height(),
                elevation: 50,
                acceleration: true,
                gradients: true,
                autoCenter: true,
                display: displayMode // ê°€ë¡œê°€ ì¢ì€ í°ì—ì„  í•œì¥, íƒœë¸”ë¦¿/PCì—ì„  ì–‘ë©´
            }});
        }}

        $(window).ready(loadApp);
        
        $(window).resize(function() {{
            var w = $('#viewport').width();
            var h = $('#viewport').height();
            $('#flipbook').turn('size', w, h);
        }});
    </script>
</body>
</html>
    """
    
    with open(os.path.join(output_dir, "index.html"), "w", encoding="utf-8") as f:
        f.write(html_content)

    print("\\n" + "=" * 50)
    print(f"âœ… ë³€í™˜ ì™„ë£Œ! '{app_name}_ì™„ì„±ë³¸' í´ë”ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
    print("=" * 50)
    time.sleep(3)

if __name__ == "__main__":
    show_intro()
    file_path = input("PDF íŒŒì¼ ê²½ë¡œ: ").strip('"')
    if os.path.exists(file_path):
        convert_to_web(file_path)
